"use strict";angular.module("MyApp",["ngCookies","ngResource","ngMessages","ngAnimate","ui.router","mgcrea.ngStrap","stormpath","stormpath.templates"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,o){t.otherwise("/"),o.html5Mode(!0),e.state("home",{url:"/",templateUrl:"html/home.html",controller:"HomeCtrl"}).state("topics",{url:"/topics/:slug",templateUrl:"html/detail.html",controller:"DetailCtrl"}).state("login",{url:"/login",templateUrl:"html/login.html",controller:"LoginCtrl"}).state("add",{url:"/add",templateUrl:"html/add.html",controller:"AddCtrl",sp:{authenticate:!0}}).state("signup",{url:"/signup",templateUrl:"html/signup.html",controller:"SignupCtrl"}).state("profile",{url:"/profile",templateUrl:"html/profile.html",controller:"ProfileCtrl",sp:{authenticate:!0}}).state("verify",{url:"/emailVerification?sptoken",templateUrl:"html/emailVerification.html",controller:"VerifyCtrl"}).state("passwordResetRequest",{url:"/password/requestReset",templateUrl:"html/passwordResetRequest.html",controller:"ResetCtrl"}).state("reset",{url:"/password/reset?sptoken",templateUrl:"html/passwordReset.html",controller:"ResetCtrl"})}]).run(["$stormpath",function(e){e.uiRouter({loginState:"login",defaultPostLoginState:"home"})}]),angular.module("MyApp").controller("AddCtrl",["$scope","$alert","Topic",function(){}]),angular.module("MyApp").controller("DetailCtrl",["$scope","$stateParams","Topic",function(e,t,o){o.getTopicBySlug(t.slug).then(function(t){e.topic=t})}]),angular.module("MyApp").controller("VerifyCtrl",["$scope","Auth",function(e,t){e.verify=function(){t.verify({name:e.displayName,email:e.email,password:e.password})},e.pageClass="fadeZoom"}]),angular.module("MyApp").controller("HomeCtrl",["$scope","Topic",function(e,t){window.$scope=e,e.categories=["MOVIES","PRODUCTS"],e.headingTitle="Top TwoCentz Topics",t.getAll().then(function(t){e.topics=t}),e.filterByCategory=function(t){e.categoryFilter=t.substring(0,t.length-1),e.headingTitle=t}}]),angular.module("MyApp").controller("LoginCtrl",["$scope","Auth",function(e,t){e.login=function(){t.login({email:e.email,password:e.password})},e.facebookLogin=function(){t.facebookLogin()},e.googleLogin=function(){t.googleLogin()},e.pageClass="fadeZoom"}]),angular.module("MyApp").controller("NavbarCtrl",["$scope","Auth",function(e,t){e.logout=function(){t.logout()}}]),angular.module("MyApp").controller("ResetCtrl",["$scope","$stateParams","Topic",function(){}]),angular.module("MyApp").controller("ProfileCtrl",["$scope","$stateParams","Topic",function(){}]),angular.module("MyApp").controller("SignupCtrl",["$scope","Auth",function(e,t){e.signup=function(){t.signup({name:e.displayName,email:e.email,password:e.password})},e.pageClass="fadeZoom"}]),angular.module("MyApp").directive("passwordStrength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=t.children(),a=Array.prototype.slice.call(r.children()),l=a.slice(-1)[0],i=a.slice(-2),s=a.slice(-3),u=a.slice(-4);t.after(r),t.bind("keyup",function(){angular.forEach(a,function(e){e.style.backgroundColor="#ebeef1"}),n.$modelValue&&(n.$modelValue.length>8?angular.forEach(u,function(e){e.style.backgroundColor="#008cdd"}):n.$modelValue.length>5?angular.forEach(s,function(e){e.style.backgroundColor="#6ead09"}):n.$modelValue.length>3?angular.forEach(i,function(e){e.style.backgroundColor="#e09115"}):l.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}),angular.module("MyApp").directive("uniqueEmail",["$http",function(e){return{restrict:"A",require:"ngModel",link:function(t,o,n,r){o.bind("blur",function(){r.$modelValue&&e.get("/api/users",{params:{email:r.$modelValue}}).success(function(e){r.$setValidity("unique",e.available)})}),o.bind("keyup",function(){r.$setValidity("unique",!0)})}}}]),angular.module("MyApp").filter("fromNow",function(){return function(e){return moment(e).fromNow()}}),angular.module("MyApp").factory("Auth",["$http","$location","$rootScope","$alert","$window",function(e,t,o,n,r){var a=r.localStorage.token;if(a){var l=JSON.parse(r.atob(a.split(".")[1]));o.currentUser=l.user}return r.fbAsyncInit=function(){FB.init({appId:"624059410963642",responseType:"token",version:"v2.0"})},function(e,t,o){var n,r=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk"),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/client:plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),{facebookLogin:function(){FB.login(function(a){FB.api("/me",function(l){var i={signedRequest:a.authResponse.signedRequest,profile:l};e.post("/auth/facebook",i).success(function(e){var a=JSON.parse(r.atob(e.split(".")[1]));r.localStorage.token=e,o.currentUser=a.user,t.path("/"),n({title:"Cheers!",content:"You have successfully signed-in with Facebook.",animation:"fadeZoomFadeDown",type:"material",duration:3})})})},{scope:"email, public_profile"})},googleLogin:function(){gapi.auth.authorize({client_id:"55262601920-5jhf3qth89okujq6a7lh8bqc9epr8475.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read",immediate:!1},function(){gapi.client.load("plus","v1",function(){var a=gapi.client.plus.people.get({userId:"me"});a.execute(function(a){e.post("/auth/google",{profile:a}).success(function(e){var a=JSON.parse(r.atob(e.split(".")[1]));r.localStorage.token=e,o.currentUser=a.user,t.path("/"),n({title:"Cheers!",content:"You have successfully signed-in with Google.",animation:"fadeZoomFadeDown",type:"material",duration:3})})})})})},login:function(a){return e.post("/auth/login",a).success(function(e){r.localStorage.token=e.token;var a=JSON.parse(r.atob(e.token.split(".")[1]));o.currentUser=a.user,t.path("/"),n({title:"Cheers!",content:"You have successfully logged in.",animation:"fadeZoomFadeDown",type:"material",duration:3})}).error(function(){delete r.localStorage.token,n({title:"Error!",content:"Invalid username or password.",animation:"fadeZoomFadeDown",type:"material",duration:3})})},signup:function(o){return e.post("/auth/signup",o).success(function(){t.path("/login"),n({title:"Congratulations!",content:"Your account has been created.",animation:"fadeZoomFadeDown",type:"material",duration:3})}).error(function(e){n({title:"Error!",content:e.data,animation:"fadeZoomFadeDown",type:"material",duration:3})})},logout:function(){delete r.localStorage.token,o.currentUser=null,n({content:"You have been logged out.",animation:"fadeZoomFadeDown",type:"material",duration:3})}}}]),angular.module("MyApp").factory("Subscription",["$http",function(e){return{subscribe:function(t){return e.post("/api/subscribe",{showId:t._id})},unsubscribe:function(t){return e.post("/api/unsubscribe",{showId:t._id})}}}]),angular.module("MyApp").factory("Topic",["$http",function(e){return{getAll:function(){return e.get("/api/topics").then(function(e){return e.data})},getTopicBySlug:function(t){return e.get("/api/topics/s/"+t).then(function(e){return e.data})}}}]);