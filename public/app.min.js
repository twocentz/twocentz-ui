angular.module("MyApp",["ngResource","ngMessages","ngRoute","ngAnimate","mgcrea.ngStrap"]).config(["$routeProvider","$locationProvider",function(e,o){o.html5Mode(!0),e.when("/",{templateUrl:"views/home.html",controller:"MainCtrl"}).when("/shows/:id",{templateUrl:"views/detail.html",controller:"DetailCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/add",{templateUrl:"views/add.html",controller:"AddCtrl"}).when("/twocentz",{templateUrl:"views/add.html",controller:"AddCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","$window","$location",function(e,o,n,t){return{request:function(e){return n.localStorage.token&&(e.headers.Authorization="Bearer "+n.localStorage.token),e},responseError:function(e){return(401===e.status||403===e.status)&&t.path("/login"),o.reject(e)}}}])}]),angular.module("MyApp").controller("AddCtrl",["$scope","$alert","Show",function(e,o,n){e.addShow=function(){n.save({showName:e.showName}).$promise.then(function(){e.showName="",e.addForm.$setPristine(),o({content:"TV show has been added.",animation:"fadeZoomFadeDown",type:"material",duration:3})}).catch(function(n){e.showName="",e.addForm.$setPristine(),o({content:n.data.message,animation:"fadeZoomFadeDown",type:"material",duration:3})})}}]),angular.module("MyApp").controller("DetailCtrl",["$scope","$rootScope","$routeParams","Show","Subscription",function(e,o,n,t,r){t.get({_id:n.id},function(n){e.show=n,e.isSubscribed=function(){return-1!==e.show.subscribers.indexOf(o.currentUser._id)},e.subscribe=function(){r.subscribe(n).success(function(){e.show.subscribers.push(o.currentUser._id)})},e.unsubscribe=function(){r.unsubscribe(n).success(function(){var n=e.show.subscribers.indexOf(o.currentUser._id);e.show.subscribers.splice(n,1)})},e.nextEpisode=n.episodes.filter(function(e){return new Date(e.firstAired)>new Date})[0]})}]),angular.module("MyApp").controller("LoginCtrl",["$scope","Auth",function(e,o){e.login=function(){o.login({email:e.email,password:e.password})},e.facebookLogin=function(){o.facebookLogin()},e.googleLogin=function(){o.googleLogin()},e.pageClass="fadeZoom"}]),angular.module("MyApp").controller("MainCtrl",["$scope","Show",function(e,o){e.alphabet=["0-9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],e.genres=["Action","Adventure","Animation","Children","Comedy","Crime","Documentary","Drama","Family","Fantasy","Food","Home and Garden","Horror","Mini-Series","Mystery","News","Reality","Romance","Sci-Fi","Sport","Suspense","Talk Show","Thriller","Travel"],e.headingTitle="Top 12 Shows",e.shows=o.query(),e.filterByGenre=function(n){e.shows=o.query({genre:n}),e.headingTitle=n},e.filterByAlphabet=function(n){e.shows=o.query({alphabet:n}),e.headingTitle=n}}]),angular.module("MyApp").controller("NavbarCtrl",["$scope","Auth",function(e,o){e.logout=function(){o.logout()}}]),angular.module("MyApp").controller("SignupCtrl",["$scope","Auth",function(e,o){e.signup=function(){o.signup({name:e.displayName,email:e.email,password:e.password})},e.pageClass="fadeZoom"}]),angular.module("MyApp").directive("passwordStrength",function(){return{restrict:"A",require:"ngModel",link:function(e,o,n,t){var r=o.children(),a=Array.prototype.slice.call(r.children()),i=a.slice(-1)[0],s=a.slice(-2),l=a.slice(-3),u=a.slice(-4);o.after(r),o.bind("keyup",function(){angular.forEach(a,function(e){e.style.backgroundColor="#ebeef1"}),t.$modelValue&&(t.$modelValue.length>8?angular.forEach(u,function(e){e.style.backgroundColor="#008cdd"}):t.$modelValue.length>5?angular.forEach(l,function(e){e.style.backgroundColor="#6ead09"}):t.$modelValue.length>3?angular.forEach(s,function(e){e.style.backgroundColor="#e09115"}):i.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}),angular.module("MyApp").directive("uniqueEmail",["$http",function(e){return{restrict:"A",require:"ngModel",link:function(o,n,t,r){n.bind("blur",function(){r.$modelValue&&e.get("/api/users",{params:{email:r.$modelValue}}).success(function(e){r.$setValidity("unique",e.available)})}),n.bind("keyup",function(){r.$setValidity("unique",!0)})}}}]),angular.module("MyApp").filter("fromNow",function(){return function(e){return moment(e).fromNow()}}),angular.module("MyApp").factory("Auth",["$http","$location","$rootScope","$alert","$window",function(e,o,n,t,r){var a=r.localStorage.token;if(a){var i=JSON.parse(r.atob(a.split(".")[1]));n.currentUser=i.user}return r.fbAsyncInit=function(){FB.init({appId:"624059410963642",responseType:"token",version:"v2.0"})},function(e,o,n){var t,r=e.getElementsByTagName(o)[0];e.getElementById(n)||(t=e.createElement(o),t.id=n,t.src="//connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(t,r))}(document,"script","facebook-jssdk"),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/client:plusone.js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o)}(),{facebookLogin:function(){FB.login(function(a){FB.api("/me",function(i){var s={signedRequest:a.authResponse.signedRequest,profile:i};e.post("/auth/facebook",s).success(function(e){var a=JSON.parse(r.atob(e.split(".")[1]));r.localStorage.token=e,n.currentUser=a.user,o.path("/"),t({title:"Cheers!",content:"You have successfully signed-in with Facebook.",animation:"fadeZoomFadeDown",type:"material",duration:3})})})},{scope:"email, public_profile"})},googleLogin:function(){gapi.auth.authorize({client_id:"55262601920-5jhf3qth89okujq6a7lh8bqc9epr8475.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read",immediate:!1},function(){gapi.client.load("plus","v1",function(){var a=gapi.client.plus.people.get({userId:"me"});a.execute(function(a){e.post("/auth/google",{profile:a}).success(function(e){var a=JSON.parse(r.atob(e.split(".")[1]));r.localStorage.token=e,n.currentUser=a.user,o.path("/"),t({title:"Cheers!",content:"You have successfully signed-in with Google.",animation:"fadeZoomFadeDown",type:"material",duration:3})})})})})},login:function(a){return e.post("/auth/login",a).success(function(e){r.localStorage.token=e.token;var a=JSON.parse(r.atob(e.token.split(".")[1]));n.currentUser=a.user,o.path("/"),t({title:"Cheers!",content:"You have successfully logged in.",animation:"fadeZoomFadeDown",type:"material",duration:3})}).error(function(){delete r.localStorage.token,t({title:"Error!",content:"Invalid username or password.",animation:"fadeZoomFadeDown",type:"material",duration:3})})},signup:function(n){return e.post("/auth/signup",n).success(function(){o.path("/login"),t({title:"Congratulations!",content:"Your account has been created.",animation:"fadeZoomFadeDown",type:"material",duration:3})}).error(function(e){t({title:"Error!",content:e.data,animation:"fadeZoomFadeDown",type:"material",duration:3})})},logout:function(){delete r.localStorage.token,n.currentUser=null,t({content:"You have been logged out.",animation:"fadeZoomFadeDown",type:"material",duration:3})}}}]),angular.module("MyApp").factory("Show",["$resource",function(e){return e("/api/shows/:_id")}]),angular.module("MyApp").factory("Subscription",["$http",function(e){return{subscribe:function(o){return e.post("/api/subscribe",{showId:o._id})},unsubscribe:function(o){return e.post("/api/unsubscribe",{showId:o._id})}}}]);